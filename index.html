<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>VORTEX V.29 | The Fixer</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700;900&family=Plus+Jakarta+Sans:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #ffffff; --card: #f8f9fa; --text: #1a1a1a;
            --accent: #007bff; --border: #dee2e6;
            --danger: #ff4757; --success: #2ed573;
        }
        [data-theme="dark"] {
            --bg: #0f0f0f; --card: #1a1a1a; --text: #ffffff;
            --accent: #ffd700; --border: #333;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Plus Jakarta Sans', sans-serif; }
        body { background: var(--bg); color: var(--text); height: 100vh; overflow: hidden; }

        #toast { position: fixed; top: 20px; left: 50%; transform: translateX(-50%); background: var(--accent); color: white; padding: 10px 20px; border-radius: 12px; font-weight: bold; z-index: 10001; display: none; font-family: 'Orbitron'; font-size: 11px; box-shadow: 0 4px 15px rgba(0,0,0,0.2); }

        header { padding: 15px 20px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--border); }
        .v-logo { font-family: 'Orbitron'; font-weight: 900; color: var(--accent); cursor: pointer; }

        .marquee-box { background: var(--accent); color: white; padding: 6px 0; overflow: hidden; white-space: nowrap; }
        .marquee-text { display: inline-block; animation: scroll 20s linear infinite; font-family: 'Orbitron'; font-size: 10px; font-weight: 900; }
        @keyframes scroll { 0% { transform: translateX(100%); } 100% { transform: translateX(-100%); } }

        .main-container { height: calc(100vh - 140px); overflow-y: auto; padding: 20px; padding-bottom: 80px; }
        .page { display: none; } .page.active { display: block; }

        .card { background: var(--card); border: 1px solid var(--border); border-radius: 20px; padding: 15px; margin-bottom: 12px; }
        input, textarea { width: 100%; background: var(--bg); border: 1px solid var(--border); padding: 12px; border-radius: 12px; color: var(--text); margin-bottom: 10px; outline: none; }
        
        .btn { border: none; padding: 10px; border-radius: 10px; font-family: 'Orbitron'; font-weight: 900; font-size: 9px; cursor: pointer; transition: 0.1s; }
        .btn-main { background: var(--accent); color: white; width: 100%; padding: 15px; font-size: 12px; }
        .btn-del { background: var(--danger); color: white; }
        .btn-edit { background: var(--success); color: white; margin-right: 5px; }

        nav { position: fixed; bottom: 15px; left: 50%; transform: translateX(-50%); width: 90%; background: var(--card); border: 1px solid var(--border); border-radius: 25px; display: none; justify-content: space-around; padding: 15px; box-shadow: 0 5px 20px rgba(0,0,0,0.1); }
        .nav-item { font-size: 20px; opacity: 0.3; cursor: pointer; } 
        .nav-item.active { opacity: 1; color: var(--accent); }
        .owner-only { display: none !important; }

        #user-editor { position: fixed; inset: 0; background: rgba(0,0,0,0.8); z-index: 10002; display: none; align-items: center; justify-content: center; padding: 20px; backdrop-filter: blur(4px); }
    </style>
</head>
<body data-theme="light">

    <div id="toast">ACTION SUCCESS!</div>

    <div id="user-editor">
        <div class="card" style="width: 100%; max-width: 350px;">
            <h3 style="font-family:'Orbitron'; margin-bottom: 15px; color: var(--accent);">EDIT USER DATA</h3>
            <label style="font-size: 10px; font-weight: bold;">USER ID</label>
            <input type="text" id="ed-id">
            <label style="font-size: 10px; font-weight: bold;">PASSWORD</label>
            <input type="text" id="ed-pass">
            <input type="hidden" id="ed-old-username">
            <button class="btn btn-main" onclick="saveUserEdit()">UPDATE USER</button>
            <button class="btn btn-del" style="width: 100%; margin-top: 10px; background: transparent; border: 1px solid var(--danger); color: var(--danger);" onclick="document.getElementById('user-editor').style.display='none'">CANCEL</button>
        </div>
    </div>

    <div id="auth-screen" style="position:fixed; inset:0; background:var(--bg); z-index:9999; display:flex; align-items:center; justify-content:center; padding:30px;">
        <div class="card" style="width:100%; max-width:400px; text-align:center;">
            <h1 class="v-logo" style="font-size:2rem;">VORTEX<span>V29</span></h1>
            <input type="text" id="au" placeholder="USERNAME">
            <input type="password" id="ap" placeholder="PASSWORD">
            <button class="btn btn-main" onclick="auth()">LOG IN</button>
        </div>
    </div>

    <header id="h-main" style="display:none">
        <div class="v-logo" onclick="document.body.setAttribute('data-theme', document.body.getAttribute('data-theme')==='light'?'dark':'light')">VORTEX<span>V29</span></div>
        <div id="role-tag" style="font-size:9px; font-weight:bold; color:var(--accent);">USER</div>
    </header>

    <div class="marquee-box" id="m-box" style="display:none">
        <div class="marquee-text">VORTEX V29 ‚Ä¢ THE FIXER ‚Ä¢ FIXED IMAGE & DELETE ‚Ä¢ INSTANT RESPONSE ‚Ä¢ MASTER RANZ_OWN CONTROL</div>
    </div>

    <div class="main-container" id="c-main" style="display:none">
        <div id="p-home" class="page active"><div id="list-prod"></div></div>
        
        <div id="p-add" class="page">
            <div class="card">
                <h3 style="font-family: 'Orbitron'; margin-bottom: 10px;">ADD PRODUCT</h3>
                <input type="hidden" id="edit-id">
                <input type="text" id="pn" placeholder="Product Name">
                <input type="text" id="pp" placeholder="Price">
                <div class="card" onclick="document.getElementById('fi').click()" style="text-align:center; border-style:dashed; cursor:pointer;">
                    <span id="ut">UPLOAD PHOTO</span>
                    <img id="pi" style="width:100%; max-height:150px; display:none; border-radius:10px; margin: 0 auto;">
                    <input type="file" id="fi" accept="image/*" style="display:none" onchange="loadImg(event)">
                </div>
                <button class="btn btn-main" onclick="saveProd()">SAVE PRODUCT</button>
            </div>
        </div>

        <div id="p-manage" class="page"><div id="list-manage"></div></div>
        
        <div id="p-db" class="page">
            <h3 style="font-family: 'Orbitron'; margin-bottom: 15px; color: var(--accent);">USER DATABASE</h3>
            <div id="list-db"></div>
        </div>
        
        <div id="p-prof" class="page">
            <div class="card" style="text-align:center;">
                <div style="width:80px; height:80px; background:var(--accent); border-radius:50%; margin:0 auto 15px; display:flex; align-items:center; justify-content:center; color:white; font-size:30px; font-weight:900;" id="prof-char">R</div>
                <h2 id="ud">@Username</h2>
                <p id="ui">ID: -</p>
                <button class="btn btn-del" style="width:100%; margin-top:20px;" onclick="localStorage.clear();location.reload();">LOGOUT</button>
            </div>
        </div>
    </div>

    <nav id="nb">
        <div class="nav-item active" onclick="nt('p-home', this)">üõçÔ∏è</div>
        <div id="n-add" class="nav-item owner-only" onclick="nt('p-add', this)">‚ûï</div>
        <div id="n-manage" class="nav-item owner-only" onclick="nt('p-manage', this)">‚öôÔ∏è</div>
        <div id="n-db" class="nav-item owner-only" onclick="nt('p-db', this)">üõ°Ô∏è</div>
        <div class="nav-item" onclick="nt('p-prof', this)">üë§</div>
    </nav>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, set, onValue, remove, get, update } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        const firebaseConfig = { databaseURL: "https://flutter-ai-playground-e9460-default-rtdb.asia-southeast1.firebasedatabase.app" };
        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const MASTER = "Ranzz_Own";
        let tempP = "";

        const showToast = (txt) => {
            const t = document.getElementById('toast');
            t.innerText = txt; t.style.display = 'block';
            setTimeout(() => { t.style.display = 'none'; }, 2000);
        };

        window.auth = async () => {
            const u = document.getElementById('au').value.trim();
            const p = document.getElementById('ap').value;
            const s = await get(ref(db, `users/${u}`));
            if(s.exists() && s.val().pass === p) {
                localStorage.setItem('vx_u', u); location.reload();
            } else alert("Access Denied!");
        };

        // --- USER SYSTEM ---
        window.openUserEdit = async (u) => {
            const s = await get(ref(db, `users/${u}`));
            const d = s.val();
            document.getElementById('ed-old-username').value = u;
            document.getElementById('ed-id').value = d.id || "";
            document.getElementById('ed-pass').value = d.pass || "";
            document.getElementById('user-editor').style.display = 'flex';
        };

        window.saveUserEdit = async () => {
            const u = document.getElementById('ed-old-username').value;
            await update(ref(db, `users/${u}`), {
                id: document.getElementById('ed-id').value,
                pass: document.getElementById('ed-pass').value
            });
            document.getElementById('user-editor').style.display = 'none';
            showToast("USER UPDATED!");
        };

        window.hapusUser = async (u) => {
            if(confirm(`Hapus user @${u}?`)) {
                await remove(ref(db, `users/${u}`));
                showToast("USER DELETED!");
            }
        };

        // --- PRODUCT SYSTEM ---
        window.loadImg = (ev) => {
            const reader = new FileReader();
            reader.onload = () => {
                tempP = reader.result;
                const pi = document.getElementById('pi');
                pi.src = tempP;
                pi.style.display = 'block';
                document.getElementById('ut').style.display = 'none';
            };
            reader.readAsDataURL(ev.target.files[0]);
        };

        window.saveProd = async () => {
            const id = document.getElementById('edit-id').value || 'p_' + Date.now();
            const data = { 
                name: document.getElementById('pn').value, 
                price: document.getElementById('pp').value 
            };
            if(tempP) data.img = tempP; // Pastikan gambar masuk ke database

            await update(ref(db, `vortex_items/${id}`), data);
            
            // RESET FORM
            tempP = "";
            document.getElementById('pn').value = "";
            document.getElementById('pp').value = "";
            document.getElementById('pi').style.display = "none";
            document.getElementById('ut').style.display = "block";
            
            showToast("PRODUCT SAVED!");
            nt('p-home', document.querySelector('.nav-item'));
        };

        // --- GLOBAL DELETE FIX ---
        window.hapusItem = async (path, id) => {
            if(confirm("HAPUS PERMANEN?")) {
                await remove(ref(db, `${path}/${id}`));
                showToast("BERHASIL DIHAPUS!");
            }
        };

        window.nt = (id, el) => {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            if(el) el.classList.add('active');
        };

        window.onload = () => {
            const u = localStorage.getItem('vx_u');
            if(!u) return;

            document.getElementById('auth-screen').style.display = 'none';
            document.getElementById('h-main').style.display = 'flex';
            document.getElementById('m-box').style.display = 'block';
            document.getElementById('c-main').style.display = 'block';
            document.getElementById('nb').style.display = 'flex';

            onValue(ref(db, `users/${u}`), (s) => {
                const d = s.val();
                document.getElementById('ud').innerText = "@" + u;
                document.getElementById('ui').innerText = "ID: " + (d.id || "000");
                document.getElementById('prof-char').innerText = u.charAt(0).toUpperCase();
            });

            if(u === MASTER) {
                document.querySelectorAll('.owner-only').forEach(e => e.style.setProperty('display','block','important'));
                document.getElementById('role-tag').innerText = "OWNER";
                
                onValue(ref(db, 'users'), (snap) => {
                    const l = document.getElementById('list-db'); l.innerHTML = '';
                    snap.forEach(us => {
                        const ud = us.val();
                        l.innerHTML += `<div class="card" style="display:flex; justify-content:space-between; align-items:center;">
                            <div><b>@${us.key}</b><br><small>PW: ${ud.pass} | ID: ${ud.id}</small></div>
                            <div>
                                <button class="btn btn-edit" onclick="openUserEdit('${us.key}')">EDIT</button>
                                <button class="btn btn-del" onclick="hapusUser('${us.key}')">DEL</button>
                            </div>
                        </div>`;
                    });
                });
            }

            // LIST PRODUK & MANAGE
            onValue(ref(db, 'vortex_items'), (snap) => {
                const lp = document.getElementById('list-prod'); lp.innerHTML = '';
                const lm = document.getElementById('list-manage'); lm.innerHTML = '';
                snap.forEach(c => {
                    const d = c.val();
                    // Tampilan Home
                    lp.innerHTML += `<div class="card" style="display:flex; gap:15px; align-items:center;">
                        <img src="${d.img || 'https://via.placeholder.com/50'}" style="width:60px; height:60px; border-radius:12px; object-fit:cover;">
                        <div><b style="font-size:14px;">${d.name}</b><br><small style="color:var(--accent);">IDR ${d.price}</small></div>
                    </div>`;
                    
                    // Tampilan Manage (Fix Delete)
                    if(u === MASTER) {
                        lm.innerHTML += `<div class="card" style="display:flex; justify-content:space-between; align-items:center;">
                            <span>${d.name}</span>
                            <button class="btn btn-del" onclick="hapusItem('vortex_items', '${c.key}')">HAPUS</button>
                        </div>`;
                    }
                });
            });
        };
    </script>
</body>
</html>
