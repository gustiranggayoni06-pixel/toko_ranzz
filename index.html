<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>RANZZSTORE | NEON GLOW</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&family=Space+Grotesk:wght@900&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #050508; --card: rgba(25, 25, 35, 0.8); --text: #ffffff;
            --accent: #00d2ff; --purple: #9d50bb; --success: #00ff88; 
            --danger: #ff3b30; --border: rgba(255,255,255,0.1);
            --logo-glow: rgba(0, 210, 255, 0.8);
        }
        [data-theme="light"] {
            --bg: #f8f9fa; --card: #ffffff; --text: #121212;
            --border: rgba(0,0,0,0.1); --accent: #007aff;
            --logo-glow: rgba(0, 122, 255, 0.3);
        }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Plus Jakarta Sans', sans-serif; transition: all 0.3s ease; }
        body { background: var(--bg); color: var(--text); height: 100vh; overflow: hidden; }

        /* --- ANIMASI LOGO MENYALA --- */
        @keyframes neonPulse {
            0% { text-shadow: 0 0 10px var(--logo-glow), 0 0 20px var(--logo-glow); opacity: 0.8; }
            50% { text-shadow: 0 0 20px var(--logo-glow), 0 0 40px var(--logo-glow), 0 0 60px var(--accent); opacity: 1; }
            100% { text-shadow: 0 0 10px var(--logo-glow), 0 0 20px var(--logo-glow); opacity: 0.8; }
        }

        header { padding: 20px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--border); backdrop-filter: blur(20px); position: sticky; top: 0; z-index: 100; }
        
        /* Logo dengan Efek Terang */
        .logo { 
            font-family: 'Space Grotesk', sans-serif; 
            font-size: 26px; 
            font-weight: 900; 
            color: var(--accent); 
            animation: neonPulse 2s infinite ease-in-out; 
            letter-spacing: -1px;
            cursor: pointer;
        }

        .main-view { height: calc(100vh - 160px); overflow-y: auto; padding: 20px; padding-bottom: 120px; }
        .page { display: none; } .page.active { display: block; animation: slideIn 0.4s ease; }
        @keyframes slideIn { from { opacity: 0; transform: scale(0.98); } to { opacity: 1; transform: scale(1); } }

        .glass-card { background: var(--card); border-radius: 24px; padding: 20px; border: 1px solid var(--border); margin-bottom: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        
        .btn { 
            background: linear-gradient(135deg, var(--accent), var(--purple)); 
            color: white; border: none; padding: 15px; border-radius: 16px; 
            font-weight: 800; width: 100%; cursor: pointer; margin-top: 10px;
            box-shadow: 0 5px 15px var(--logo-glow);
        }
        
        .input-box { background: rgba(128,128,128,0.1); border: 1px solid var(--border); padding: 15px; border-radius: 14px; color: var(--text); width: 100%; margin-bottom: 12px; outline: none; }

        nav { position: fixed; bottom: 25px; left: 20px; right: 20px; background: var(--card); backdrop-filter: blur(30px); border: 1px solid var(--border); border-radius: 35px; display: flex; justify-content: space-around; padding: 18px; z-index: 1000; }
        .nav-item { font-size: 24px; cursor: pointer; opacity: 0.3; }
        .nav-item.active { opacity: 1; color: var(--accent); transform: translateY(-5px); filter: drop-shadow(0 0 8px var(--accent)); }

        #theme-btn { font-size: 22px; cursor: pointer; filter: drop-shadow(0 0 5px orange); }
    </style>
</head>
<body data-theme="dark">

    <header>
        <div class="logo" onclick="location.reload()">RANZZSTORE</div>
        <div style="display: flex; align-items: center; gap: 15px;">
            <div id="theme-btn" onclick="toggleTheme()">üí°</div>
            <div id="main-balance" style="font-weight: 800; color: var(--success); text-shadow: 0 0 5px var(--success);">Rp 0</div>
        </div>
    </header>

    <div class="main-view">
        <div id="p-home" class="page active">
            <h2 style="margin-bottom: 20px; letter-spacing: -1px;">Premium Catalog ‚ö°</h2>
            <div id="prod-list" style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;"></div>
        </div>

        <div id="p-db" class="page">
            <h2 style="margin-bottom: 20px;">Master Control üìä</h2>
            <div class="glass-card">
                <h4 style="margin-bottom:15px; color: var(--accent);">Manajemen Seluruh Akun</h4>
                <div id="user-manage-list"></div>
            </div>
        </div>

        <div id="p-prof" class="page">
            <div id="auth-ui" class="glass-card">
                <h2 style="text-align: center; margin-bottom: 20px;">Akses Masuk</h2>
                <input type="text" id="l-user" class="input-box" placeholder="USERNAME">
                <input type="password" id="l-pass" class="input-box" placeholder="PASSWORD">
                <button class="btn" onclick="handleAuth('LOGIN')">MASUK KE SYSTEM</button>
                <button class="btn" style="background:transparent; border:1px solid var(--accent); color: var(--text);" onclick="handleAuth('REG')">DAFTAR AKUN</button>
            </div>
            <div id="user-ui" style="display:none;">
                <div class="glass-card" style="text-align: center; border: 2px solid var(--accent); box-shadow: 0 0 20px var(--logo-glow);">
                    <div style="font-size: 45px;">üë§</div>
                    <h2 id="u-name-display" style="text-transform: uppercase; letter-spacing: 2px;">-</h2>
                </div>
                <div class="glass-card">
                    <h4>Keamanan Akun</h4>
                    <input type="password" id="new-pw" class="input-box" placeholder="Password Baru">
                    <button class="btn" onclick="changePW()">SIMPAN SANDI</button>
                    <button class="btn" style="background: var(--danger); margin-top: 25px; box-shadow: 0 5px 15px rgba(255,0,0,0.3);" onclick="logout()">LOGOUT</button>
                </div>
            </div>
        </div>
    </div>

    <nav>
        <div class="nav-item active" onclick="nt('p-home', this)">üè†</div>
        <div class="nav-item" onclick="alert('Hubungi Master Ranzz untuk Top Up!')">üí∏</div>
        <div id="owner-nav" style="display: contents;"></div>
        <div class="nav-item" id="prof-nav" onclick="nt('p-prof', this)">üë§</div>
    </nav>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, set, onValue, get, update, remove } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        const conf = { databaseURL: "https://flutter-ai-playground-e9460-default-rtdb.asia-southeast1.firebasedatabase.app" };
        const app = initializeApp(conf);
        const db = getDatabase(app);
        
        let sessionKey = 'ranzz_glow_session';
        let user = JSON.parse(localStorage.getItem(sessionKey));

        window.toggleTheme = () => {
            const b = document.body;
            const current = b.getAttribute('data-theme');
            const target = current === 'dark' ? 'light' : 'dark';
            b.setAttribute('data-theme', target);
            document.getElementById('theme-btn').innerText = target === 'dark' ? 'üí°' : 'üåô';
        };

        window.handleAuth = async (m) => {
            const u = document.getElementById('l-user').value.trim();
            const p = document.getElementById('l-pass').value;
            if(!u || !p) return alert("Isi Username & Password!");
            
            const r = ref(db, 'ranzz_glow_users/'+u);
            const s = await get(r);

            if(m==='LOGIN'){
                if(s.exists() && s.val().password === p){
                    localStorage.setItem(sessionKey, JSON.stringify(s.val()));
                    location.reload();
                } else {
                    alert("Akun tidak ditemukan atau salah password. Jika Master, klik DAFTAR dulu.");
                }
            } else {
                if(s.exists()) return alert("Username sudah ada!");
                const role = (u === "Ranzz_Own") ? "OWNER" : "MEMBER";
                await set(r, {username:u, password:p, balance:0, role: role});
                alert("Pendaftaran Berhasil! Sekarang silakan Login.");
            }
        };

        if(user){
            document.getElementById('auth-ui').style.display = 'none';
            document.getElementById('user-ui').style.display = 'block';
            document.getElementById('u-name-display').innerText = user.username;
            
            onValue(ref(db, `ranzz_glow_users/${user.username}/balance`), s => {
                document.getElementById('main-balance').innerText = "Rp " + (s.val() || 0).toLocaleString();
            });

            if(user.username === "Ranzz_Own") {
                document.getElementById('owner-nav').innerHTML = `<div class="nav-item" onclick="nt('p-db', this)">üìä</div>`;
                initMaster();
            }
        }

        function initMaster() {
            onValue(ref(db, 'ranzz_glow_users'), s => {
                const l = document.getElementById('user-manage-list'); l.innerHTML = "";
                s.forEach(u => {
                    const d = u.val();
                    l.innerHTML += `
                    <div class="glass-card" style="padding:15px; margin-bottom:10px; border:1px solid rgba(0,210,255,0.2);">
                        <div style="display:flex; justify-content:space-between; margin-bottom:10px;">
                            <b style="color:var(--accent)">${d.username}</b> <b>Rp ${d.balance.toLocaleString()}</b>
                        </div>
                        <button class="btn" style="padding:8px; font-size:10px; width:auto; margin-right:5px;" onclick="masterEdit('${d.username}','PW')">GANTI PW</button>
                        <button class="btn" style="padding:8px; font-size:10px; width:auto; background:var(--success); color:black;" onclick="masterEdit('${d.username}','BAL')">EDIT SALDO</button>
                        <button class="btn" style="padding:8px; font-size:10px; width:auto; background:var(--danger);" onclick="masterEdit('${d.username}','DEL')">HAPUS</button>
                    </div>`;
                });
            });
        }

        window.masterEdit = async (target, act) => {
            const r = ref(db, 'ranzz_glow_users/'+target);
            if(act === 'PW') {
                const p = prompt("Password Baru untuk " + target);
                if(p) await update(r, {password: p});
            } else if(act === 'BAL') {
                const b = prompt("Set Saldo Baru untuk " + target);
                if(b) await update(r, {balance: parseInt(b)});
            } else if(act === 'DEL') {
                if(confirm("Hapus akun " + target + "?")) await remove(r);
            }
            alert("Operasi Berhasil!");
        };

        window.nt = (id, el) => {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            el.classList.add('active');
        };

        window.logout = () => { localStorage.clear(); location.reload(); };
        window.changePW = async () => {
            const n = document.getElementById('new-pw').value;
            if(n) {
                await update(ref(db, `ranzz_glow_users/${user.username}`), {password: n});
                alert("Password Terupdate!");
            }
        };
    </script>
</body>
</html>
