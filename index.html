<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>RANZZSTORE | V.185 PRODUCT ENGINE</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&family=Space+Grotesk:wght@900&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #050508; --card: rgba(25, 25, 35, 0.98); --text: #ffffff;
            --accent: #00d2ff; --purple: #9d50bb; --success: #00ff88; 
            --danger: #ff3b30; --border: rgba(255,255,255,0.1);
        }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Plus Jakarta Sans', sans-serif; }
        body { background: var(--bg); color: var(--text); height: 100vh; overflow: hidden; }

        header { padding: 25px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; }
        .logo { font-family: 'Space Grotesk', sans-serif; font-size: 26px; font-weight: 900; color: var(--accent); }

        .main-view { height: calc(100vh - 160px); overflow-y: auto; padding: 20px; padding-bottom: 100px; }
        .page { display: none; } .page.active { display: block; }

        .glass-card { background: var(--card); border-radius: 25px; padding: 20px; border: 1px solid var(--border); margin-bottom: 15px; }
        .prod-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        .prod-item { background: var(--card); border: 1px solid var(--border); border-radius: 20px; padding: 15px; text-align: center; }
        
        .btn { background: linear-gradient(135deg, var(--accent), var(--purple)); color: white; border: none; padding: 14px; border-radius: 15px; font-weight: 800; width: 100%; cursor: pointer; margin-top: 5px; font-size: 13px; }
        .btn-mini { padding: 8px; font-size: 10px; width: auto; margin-right: 5px; border-radius: 8px; border: none; cursor: pointer; }
        .input-box { background: rgba(255,255,255,0.05); border: 1px solid var(--border); padding: 12px; border-radius: 12px; color: var(--text); width: 100%; margin-bottom: 10px; outline: none; }

        nav { position: fixed; bottom: 20px; left: 20px; right: 20px; background: var(--card); border: 1px solid var(--border); border-radius: 35px; display: flex; justify-content: space-around; padding: 18px; }
        .nav-item { font-size: 24px; opacity: 0.3; cursor: pointer; }
        .nav-item.active { opacity: 1; color: var(--accent); }
    </style>
</head>
<body>

    <header>
        <div class="logo">RANZZSTORE</div>
        <div id="main-balance" style="font-weight: 900; color: var(--success);">Rp 0</div>
    </header>

    <div class="main-view">
        <div id="p-home" class="page active">
            <h2 style="margin-bottom: 20px;">Store ‚ú®</h2>
            <div id="catalog" class="prod-grid"></div>
        </div>

        <div id="p-depo" class="page">
            <h2 style="margin-bottom: 15px;">Deposit üí∏</h2>
            <div class="glass-card">
                <small>DANA: 081218002778 (S*****I)</small><br>
                <small>GOPAY: 085718522934 (D***D R*****I R****N)</small>
                <input type="number" id="amt" class="input-box" style="margin-top:10px" placeholder="Nominal">
                <button class="btn" onclick="submitDepo()">KIRIM BUKTI</button>
            </div>
        </div>

        <div id="p-db" class="page">
            <h2 style="margin-bottom: 20px;">Master Control üìä</h2>
            
            <div class="glass-card" style="border-left: 4px solid var(--success);">
                <h4>Tambah Produk</h4>
                <input type="text" id="new-p-name" class="input-box" placeholder="Nama (ex: 100 Diamond)">
                <input type="number" id="new-p-price" class="input-box" placeholder="Harga (ex: 15000)">
                <button class="btn" onclick="saveProduct()">SIMPAN PRODUK</button>
            </div>

            <div class="glass-card">
                <h4 style="color: var(--accent);">Daftar Produk Store</h4>
                <div id="master-prod-list" style="margin-top:10px;"></div>
            </div>

            <div class="glass-card">
                <h4 style="color: var(--purple);">Database Akun</h4>
                <div id="master-user-list" style="margin-top:10px;"></div>
            </div>
        </div>

        <div id="p-prof" class="page">
            <div id="auth-ui" class="glass-card">
                <input type="text" id="u" class="input-box" placeholder="USERNAME">
                <input type="password" id="p" class="input-box" placeholder="PASSWORD">
                <button class="btn" onclick="auth('LOGIN')">MASUK</button>
                <button class="btn" style="background:transparent; border:1px solid var(--accent);" onclick="auth('REG')">DAFTAR</button>
            </div>
            <div id="user-ui" style="display:none; text-align:center;">
                <h2 id="u-name">-</h2>
                <button class="btn" style="background:var(--danger);" onclick="logout()">LOGOUT</button>
            </div>
        </div>
    </div>

    <nav>
        <div class="nav-item active" onclick="nt('p-home', this)">üè†</div>
        <div class="nav-item" onclick="checkAuth('p-depo', this)">üí∏</div>
        <div id="owner-slot" style="display:contents;"></div>
        <div class="nav-item" id="p-btn" onclick="nt('p-prof', this)">üë§</div>
    </nav>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, set, onValue, push, remove, get, update } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        const cfg = { databaseURL: "https://flutter-ai-playground-e9460-default-rtdb.asia-southeast1.firebasedatabase.app" };
        const app = initializeApp(cfg);
        const db = getDatabase(app);
        const S = 'ranzz_stable_v185';
        let user = JSON.parse(localStorage.getItem(S));

        // --- MANAJEMEN PRODUK ---
        window.saveProduct = () => {
            const name = document.getElementById('new-p-name').value;
            const price = document.getElementById('new-p-price').value;
            if(!name || !price) return alert("Lengkapi data produk!");
            push(ref(db, S + '_products'), { name, price: parseInt(price) });
            alert("Produk Berhasil Ditambah!");
            document.getElementById('new-p-name').value = "";
            document.getElementById('new-p-price').value = "";
        };

        function loadStore() {
            onValue(ref(db, S + '_products'), s => {
                const catalog = document.getElementById('catalog');
                const mList = document.getElementById('master-prod-list');
                catalog.innerHTML = ""; mList.innerHTML = "";
                
                s.forEach(child => {
                    const p = child.val();
                    // Tampilan Member
                    catalog.innerHTML += `<div class="prod-item">
                        <div style="font-size:24px;">üì¶</div>
                        <b style="font-size:12px;">${p.name}</b><br>
                        <small style="color:var(--success)">Rp ${p.price.toLocaleString()}</small>
                        <button class="btn" style="font-size:10px; padding:8px; margin-top:10px;" onclick="alert('Order: ${p.name}')">BELI</button>
                    </div>`;
                    // Tampilan Master
                    mList.innerHTML += `<div style="display:flex; justify-content:space-between; align-items:center; border-bottom:1px solid var(--border); padding:8px 0;">
                        <small>${p.name} - Rp ${p.price}</small>
                        <button class="btn-mini" style="background:var(--danger); color:white;" onclick="delProd('${child.key}')">HAPUS</button>
                    </div>`;
                });
            });
        }

        window.delProd = (id) => { if(confirm("Hapus produk?")) remove(ref(db, S + '_products/' + id)); };

        // --- MASTER USER ---
        function loadMasterUsers() {
            onValue(ref(db, S + '_users'), s => {
                const list = document.getElementById('master-user-list');
                list.innerHTML = "";
                s.forEach(child => {
                    const u = child.val();
                    list.innerHTML += `<div class="glass-card" style="padding:10px; font-size:12px;">
                        <b>${u.username}</b> - Pw: ${u.password}
                        <div style="margin-top:5px;">
                            <button class="btn-mini" style="background:var(--accent); color:black;" onclick="editUser('${u.username}')">EDIT</button>
                        </div>
                    </div>`;
                });
            });
        }

        window.editUser = async (oldU) => {
            const newU = prompt("Username Baru:", oldU);
            const newP = prompt("Password Baru:");
            if(newU && newP) {
                const snap = await get(ref(db, S + '_users/' + oldU));
                await remove(ref(db, S + '_users/' + oldU));
                await set(ref(db, S + '_users/' + newU), { ...snap.val(), username: newU, password: newP });
                alert("Data diperbarui!");
            }
        };

        // --- AUTH ---
        window.auth = async (m) => {
            const uVal = document.getElementById('u').value.trim();
            const pVal = document.getElementById('p').value;
            if(uVal === "Ranzz_Own" && pVal === "300810") {
                const mo = {username: uVal, password: pVal, role: "OWNER", balance: 9999999};
                await set(ref(db, S + '_users/' + uVal), mo);
                localStorage.setItem(S, JSON.stringify(mo));
                location.reload(); return;
            }
            const r = ref(db, S + '_users/' + uVal);
            if(m === 'LOGIN') {
                const s = await get(r);
                if(s.exists() && s.val().password === pVal) { localStorage.setItem(S, JSON.stringify(s.val())); location.reload(); }
                else alert("Gagal!");
            } else {
                await set(r, { username: uVal, password: pVal, balance: 0, role: "MEMBER" });
                alert("Berhasil Daftar!");
            }
        };

        if(user) {
            document.getElementById('auth-ui').style.display = 'none';
            document.getElementById('user-ui').style.display = 'block';
            document.getElementById('u-name').innerText = user.username;
            loadStore();
            if(user.role === "OWNER") {
                document.getElementById('owner-slot').innerHTML = '<div class="nav-item" onclick="nt(\'p-db\', this)">üìä</div>';
                loadMasterUsers();
            }
            onValue(ref(db, S + '_users/' + user.username + '/balance'), s => {
                document.getElementById('main-balance').innerText = "Rp " + (s.val() || 0).toLocaleString();
            });
        }

        window.nt = (id, el) => {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            el.classList.add('active');
        };
        window.checkAuth = (id, el) => { if(!user){ alert("Login dulu!"); nt('p-prof', document.getElementById('p-btn')); } else nt(id, el); };
        window.logout = () => { localStorage.clear(); location.reload(); };
    </script>
</body>
</html>
