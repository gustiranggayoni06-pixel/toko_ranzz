<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>RANZZSTORE | V.190 SUPREME</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&family=Space+Grotesk:wght@900&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #020204; --card: rgba(15, 15, 25, 0.9); --text: #ffffff;
            --accent: #00d2ff; --purple: #9d50bb; --success: #00ff88; 
            --danger: #ff3b30; --border: rgba(255,255,255,0.1);
        }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Plus Jakarta Sans', sans-serif; }
        body { background: var(--bg); color: var(--text); height: 100vh; overflow: hidden; }

        @keyframes neon-glow {
            0%, 100% { text-shadow: 0 0 10px var(--accent), 0 0 20px var(--accent); color: var(--accent); }
            50% { text-shadow: 0 0 10px var(--purple), 0 0 20px var(--purple); color: var(--purple); }
        }
        header { padding: 25px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; }
        .logo { font-family: 'Space Grotesk', sans-serif; font-size: 26px; font-weight: 900; animation: neon-glow 2s infinite; }
        .feature-title { font-weight: 800; font-size: 20px; margin-bottom: 20px; animation: neon-glow 3s infinite; display: block; }

        .main-view { height: calc(100vh - 160px); overflow-y: auto; padding: 20px; padding-bottom: 100px; }
        .page { display: none; } .page.active { display: block; }

        .glass-card { background: var(--card); border-radius: 25px; padding: 20px; border: 1px solid var(--border); margin-bottom: 15px; }
        .pay-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 15px; }
        .pay-btn { background: rgba(255,255,255,0.05); border: 1px solid var(--border); padding: 15px; border-radius: 15px; text-align: center; cursor: pointer; }
        .pay-btn.active { border-color: var(--accent); color: var(--accent); background: rgba(0,210,255,0.1); box-shadow: 0 0 10px var(--accent); }

        .btn { background: linear-gradient(135deg, var(--accent), var(--purple)); color: white; border: none; padding: 16px; border-radius: 18px; font-weight: 800; width: 100%; cursor: pointer; margin-top: 10px; }
        .upload-area { border: 2px dashed var(--border); border-radius: 15px; padding: 20px; text-align: center; cursor: pointer; margin-top: 10px; }
        .preview-img { width: 100%; border-radius: 10px; margin-top: 10px; display: none; }
        .input-box { background: rgba(255,255,255,0.05); border: 1px solid var(--border); padding: 14px; border-radius: 15px; color: var(--text); width: 100%; margin-bottom: 10px; outline: none; }

        nav { position: fixed; bottom: 20px; left: 20px; right: 20px; background: var(--card); border: 1px solid var(--border); border-radius: 35px; display: flex; justify-content: space-around; padding: 18px; }
        .nav-item { font-size: 24px; opacity: 0.3; cursor: pointer; }
        .nav-item.active { opacity: 1; color: var(--accent); transform: scale(1.1); }
    </style>
</head>
<body>

    <header>
        <div class="logo">RANZZSTORE</div>
        <div id="main-balance" style="font-weight: 900; color: var(--success);">Rp 0</div>
    </header>

    <div class="main-view">
        <div id="p-home" class="page active">
            <span class="feature-title">CATALOG STORE ‚ö°</span>
            <div id="catalog-grid" style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;"></div>
        </div>

        <div id="p-depo" class="page">
            <span class="feature-title">TOP UP SALDO üí∏</span>
            <div class="glass-card">
                <div class="pay-grid">
                    <div class="pay-btn" id="btn-dana" onclick="selPay('DANA', '081218002778', 'S*****I')">DANA</div>
                    <div class="pay-btn" id="btn-gopay" onclick="selPay('GOPAY', '085718522934', 'D***D R*****I R****N')">GOPAY</div>
                </div>
                
                <div id="pay-info" style="display:none; margin-bottom:15px; background:rgba(255,255,255,0.03); padding:15px; border-radius:15px; font-size:12px; text-align:center; border:1px solid var(--border);">
                    No Tujuan: <b id="pay-num" style="color:var(--accent); display:block; font-size:18px; margin:5px 0;">-</b>
                    A/N: <span id="pay-name" style="color:var(--success); font-weight:800;">-</span>
                </div>

                <input type="number" id="amt" class="input-box" placeholder="Nominal Rp">
                
                <div id="owner-bypass-msg" style="display:none; color:var(--success); font-size:11px; margin-bottom:10px;">‚ö° Master Mode: Foto tidak wajib.</div>
                
                <div class="upload-area" id="up-box" onclick="document.getElementById('file-ss').click()">
                    <span id="up-txt">Upload Bukti TF (Wajib) üì∏</span>
                    <img id="prev-ss" class="preview-img">
                    <input type="file" id="file-ss" hidden accept="image/*" onchange="prev(this, 'prev-ss', 'up-txt')">
                </div>

                <button class="btn" onclick="sendDepo()">KONFIRMASI SEKARANG</button>
            </div>
        </div>

        <div id="p-add" class="page">
            <span class="feature-title">ADD PRODUCT üõçÔ∏è</span>
            <div class="glass-card">
                <input type="text" id="p-name" class="input-box" placeholder="Nama Produk">
                <input type="number" id="p-price" class="input-box" placeholder="Harga">
                <div class="upload-area" onclick="document.getElementById('file-p').click()">
                    <span id="up-p-txt">Foto Produk üñºÔ∏è</span>
                    <img id="prev-p" class="preview-img">
                    <input type="file" id="file-p" hidden accept="image/*" onchange="prev(this, 'prev-p', 'up-p-txt')">
                </div>
                <button class="btn" style="background:var(--success); color:black;" onclick="saveP()">POSTING PRODUK</button>
            </div>
        </div>

        <div id="p-db" class="page">
            <span class="feature-title">DATABASE MASTER üìä</span>
            <div id="master-req"></div>
            <div id="master-users"></div>
        </div>

        <div id="p-prof" class="page">
            <div id="auth-ui" class="glass-card">
                <input type="text" id="u" class="input-box" placeholder="Username">
                <input type="password" id="p" class="input-box" placeholder="Password">
                <button class="btn" onclick="auth('LOGIN')">MASUK</button>
                <button class="btn" style="background:transparent; border:1px solid var(--border);" onclick="auth('REG')">DAFTAR</button>
            </div>
            <div id="user-ui" style="display:none; text-align:center;">
                <h2 id="u-display" style="animation: neon-glow 2s infinite;">-</h2>
                <button class="btn" style="background:var(--danger);" onclick="logout()">LOGOUT</button>
            </div>
        </div>
    </div>

    <nav>
        <div class="nav-item active" onclick="nt('p-home', this)">üè†</div>
        <div class="nav-item" onclick="checkAuth('p-depo', this)">üí∏</div>
        <div id="owner-slot" style="display:contents;"></div>
        <div class="nav-item" id="p-btn" onclick="nt('p-prof', this)">üë§</div>
    </nav>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, set, onValue, push, remove, get, update } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        const cfg = { databaseURL: "https://flutter-ai-playground-e9460-default-rtdb.asia-southeast1.firebasedatabase.app" };
        const app = initializeApp(cfg);
        const db = getDatabase(app);
        const S = 'ranzz_supreme_v190';
        let user = JSON.parse(localStorage.getItem(S));
        let selMet = "";

        window.prev = (input, imgId, txtId) => {
            const f = input.files[0];
            if(f){
                const r = new FileReader();
                r.onload = (e) => {
                    document.getElementById(imgId).src = e.target.result;
                    document.getElementById(imgId).style.display = 'block';
                    document.getElementById(txtId).style.display = 'none';
                };
                r.readAsDataURL(f);
            }
        };

        window.selPay = (m, num, name) => {
            selMet = m;
            document.querySelectorAll('.pay-btn').forEach(b => b.classList.remove('active'));
            document.getElementById('btn-' + m.toLowerCase()).classList.add('active');
            document.getElementById('pay-info').style.display = 'block';
            document.getElementById('pay-num').innerText = num;
            document.getElementById('pay-name').innerText = name;
        };

        window.sendDepo = () => {
            const amt = document.getElementById('amt').value;
            const ss = document.getElementById('prev-ss').src;
            const isOwner = user && user.role === "OWNER";

            if(!selMet) return alert("Pilih metode pembayaran!");
            if(!amt) return alert("Isi nominal!");
            if(!isOwner && !ss.startsWith('data')) return alert("Wajib upload bukti transfer!");

            push(ref(db, S + '_req'), { 
                user: user.username, 
                amount: parseInt(amt), 
                method: selMet, 
                ss: ss.startsWith('data') ? ss : 'MASTER_TESTING' 
            });
            alert("Berhasil! Menunggu ACC Master.");
            location.reload();
        };

        window.saveP = () => {
            const n = document.getElementById('p-name').value;
            const p = document.getElementById('p-price').value;
            const i = document.getElementById('prev-p').src;
            if(!n || !p) return;
            push(ref(db, S + '_prods'), { name:n, price:parseInt(p), img: i.startsWith('data') ? i : '' });
            alert("Produk Berhasil Ditambah!");
            location.reload();
        };

        // LOAD DATA
        onValue(ref(db, S + '_prods'), s => {
            const grid = document.getElementById('catalog-grid');
            grid.innerHTML = "";
            s.forEach(c => {
                const p = c.val();
                grid.innerHTML += `<div class="glass-card" style="text-align:center; padding:10px;">
                    <img src="${p.img || ''}" style="width:100%; height:80px; object-fit:cover; border-radius:10px; margin-bottom:10px;">
                    <b style="font-size:12px;">${p.name}</b><br>
                    <small style="color:var(--success)">Rp ${p.price.toLocaleString()}</small>
                    <button class="btn" style="font-size:10px; padding:8px;">BELI</button>
                </div>`;
            });
        });

        function loadMaster() {
            onValue(ref(db, S + '_req'), s => {
                const list = document.getElementById('master-req');
                list.innerHTML = "<h4 style='color:var(--accent)'>Request Saldo</h4>";
                s.forEach(c => {
                    const r = c.val();
                    list.innerHTML += `<div class="glass-card" style="font-size:11px;">
                        ${r.user} | ${r.method} | Rp ${r.amount.toLocaleString()}
                        ${r.ss !== 'MASTER_TESTING' ? `<img src="${r.ss}" style="width:100%; border-radius:10px; margin:10px 0;">` : '<p style="color:var(--success)">[MASTER BYPASS]</p>'}
                        <div style="display:flex; gap:10px;">
                            <button class="btn" style="background:var(--success); color:black; flex:1;" onclick="accD('${c.key}','${r.user}',${r.amount})">ACC</button>
                            <button class="btn" style="background:var(--danger); flex:1;" onclick="rejD('${c.key}')">REJECT</button>
                        </div>
                    </div>`;
                });
            });
            onValue(ref(db, S + '_users'), s => {
                const list = document.getElementById('master-users');
                list.innerHTML = "<h4>Database User</h4>";
                s.forEach(c => {
                    const u = c.val();
                    list.innerHTML += `<div class="glass-card" style="display:flex; justify-content:space-between; align-items:center; font-size:11px;">
                        <div><b>${u.username}</b><br>Pw: ${u.password}</div>
                        <button class="btn" style="width:auto; padding:5px 15px; margin:0;" onclick="editU('${u.username}')">EDIT</button>
                    </div>`;
                });
            });
        }

        window.accD = async (k, t, a) => {
            const snap = await get(ref(db, S + '_users/' + t));
            await update(ref(db, S + '_users/' + t), { balance: (snap.val().balance || 0) + a });
            remove(ref(db, S + '_req/' + k));
        };
        window.rejD = (k) => remove(ref(db, S + '_req/' + k));
        window.editU = async (u) => {
            const p = prompt("Password baru:");
            if(p) update(ref(db, S + '_users/' + u), { password: p });
        };

        window.auth = async (m) => {
            const uVal = document.getElementById('u').value.trim();
            const pVal = document.getElementById('p').value;
            if(uVal === "Ranzz_Own" && pVal === "300810") {
                const mo = {username:uVal, password:pVal, role:"OWNER", balance:999999};
                await set(ref(db, S + '_users/' + uVal), mo);
                localStorage.setItem(S, JSON.stringify(mo));
                location.reload(); return;
            }
            const r = ref(db, S + '_users/' + uVal);
            if(m === 'LOGIN') {
                const s = await get(r);
                if(s.exists() && s.val().password === pVal) { localStorage.setItem(S, JSON.stringify(s.val())); location.reload(); }
                else alert("Login Gagal!");
            } else {
                await set(r, { username: uVal, password: pVal, balance: 0, role: "MEMBER" });
                alert("Daftar Berhasil!");
            }
        };

        if(user) {
            document.getElementById('auth-ui').style.display = 'none';
            document.getElementById('user-ui').style.display = 'block';
            document.getElementById('u-display').innerText = user.username;
            if(user.role === "OWNER") {
                document.getElementById('owner-slot').innerHTML = `
                    <div class="nav-item" onclick="nt('p-add', this)">üõçÔ∏è</div>
                    <div class="nav-item" onclick="nt('p-db', this)">üìä</div>`;
                document.getElementById('owner-bypass-msg').style.display = 'block';
                loadMaster();
            }
            onValue(ref(db, S + '_users/' + user.username + '/balance'), s => {
                document.getElementById('main-balance').innerText = "Rp " + (s.val() || 0).toLocaleString();
            });
        }

        window.nt = (id, el) => {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            el.classList.add('active');
        };
        window.checkAuth = (id, el) => { if(!user) nt('p-prof', document.getElementById('p-btn')); else nt(id, el); };
        window.logout = () => { localStorage.clear(); location.reload(); };
    </script>
</body>
</html>
