<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>VORTEX V.30 | Visual Power</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700;900&family=Plus+Jakarta+Sans:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #ffffff; --card: #f8f9fa; --text: #1a1a1a;
            --accent: #007bff; --border: #dee2e6;
            --danger: #ff4757; --success: #2ed573;
        }
        [data-theme="dark"] {
            --bg: #0f0f0f; --card: #1a1a1a; --text: #ffffff;
            --accent: #ffd700; --border: #333;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Plus Jakarta Sans', sans-serif; }
        body { background: var(--bg); color: var(--text); height: 100vh; overflow: hidden; }

        /* NOTIFIKASI TOAST STYLED */
        #toast { position: fixed; top: 30px; left: 50%; transform: translateX(-50%); background: #1a1a1a; color: #00ff00; padding: 12px 25px; border-radius: 30px; font-weight: 900; z-index: 10001; display: none; font-family: 'Orbitron'; font-size: 10px; border: 2px solid var(--success); box-shadow: 0 10px 20px rgba(0,0,0,0.3); animation: pop 0.3s ease; }
        @keyframes pop { from { transform: translateX(-50%) scale(0.8); } to { transform: translateX(-50%) scale(1); } }

        header { padding: 15px 20px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--border); }
        .v-logo { font-family: 'Orbitron'; font-weight: 900; color: var(--accent); }

        .main-container { height: calc(100vh - 140px); overflow-y: auto; padding: 20px; }
        .page { display: none; } .page.active { display: block; }

        .card { background: var(--card); border: 1px solid var(--border); border-radius: 20px; padding: 15px; margin-bottom: 12px; }
        input { width: 100%; background: var(--bg); border: 1px solid var(--border); padding: 12px; border-radius: 12px; color: var(--text); margin-bottom: 10px; outline: none; }
        
        .btn { border: none; padding: 12px; border-radius: 12px; font-family: 'Orbitron'; font-weight: 900; font-size: 10px; cursor: pointer; }
        .btn-main { background: var(--accent); color: white; width: 100%; }
        .btn-del { background: var(--danger); color: white; padding: 8px 15px; }

        /* PREVIEW GAMBAR BOX */
        .img-upload-box { border: 2px dashed var(--accent); border-radius: 15px; padding: 20px; text-align: center; cursor: pointer; margin-bottom: 15px; position: relative; overflow: hidden; min-height: 100px; display: flex; align-items: center; justify-content: center; }
        #pi { width: 100%; max-height: 200px; object-fit: contain; border-radius: 10px; display: none; }

        nav { position: fixed; bottom: 15px; left: 50%; transform: translateX(-50%); width: 90%; background: var(--card); border: 1px solid var(--border); border-radius: 25px; display: none; justify-content: space-around; padding: 15px; box-shadow: 0 5px 20px rgba(0,0,0,0.1); }
        .nav-item { font-size: 20px; opacity: 0.3; } 
        .nav-item.active { opacity: 1; color: var(--accent); }
        .owner-only { display: none !important; }
    </style>
</head>
<body data-theme="light">

    <div id="toast">PRODUK TELAH DIBUAT!</div>

    <div id="auth-screen" style="position:fixed; inset:0; background:var(--bg); z-index:9999; display:flex; align-items:center; justify-content:center; padding:30px;">
        <div class="card" style="width:100%; max-width:400px; text-align:center;">
            <h1 class="v-logo" style="font-size:2rem;">VORTEX<span>V30</span></h1>
            <input type="text" id="au" placeholder="USERNAME">
            <input type="password" id="ap" placeholder="PASSWORD">
            <button class="btn btn-main" onclick="auth()">LOG IN</button>
        </div>
    </div>

    <header id="h-main" style="display:none">
        <div class="v-logo">VORTEX<span>V30</span></div>
        <div id="role-tag" style="font-size:9px; font-weight:bold; color:var(--accent);">USER</div>
    </header>

    <div class="main-container" id="c-main" style="display:none">
        <div id="p-home" class="page active"><div id="list-prod"></div></div>
        
        <div id="p-add" class="page">
            <div class="card">
                <h3 style="font-family:'Orbitron'; margin-bottom:15px;">ADD PRODUCT</h3>
                <input type="text" id="pn" placeholder="Nama Produk">
                <input type="text" id="pp" placeholder="Harga (Contoh: 50.000)">
                
                <div class="img-upload-box" onclick="document.getElementById('fi').click()">
                    <span id="ut">üì∏ KLIK UNTUK TAMBAH FOTO</span>
                    <img id="pi">
                    <input type="file" id="fi" accept="image/*" style="display:none" onchange="previewFile(this)">
                </div>
                
                <button class="btn btn-main" id="btn-save" onclick="saveProduct()">SIMPAN PRODUK</button>
            </div>
        </div>

        <div id="p-manage" class="page"><div id="list-manage"></div></div>
    </div>

    <nav id="nb">
        <div class="nav-item active" onclick="nt('p-home', this)">üõçÔ∏è</div>
        <div id="n-add" class="nav-item owner-only" onclick="nt('p-add', this)">‚ûï</div>
        <div id="n-manage" class="nav-item owner-only" onclick="nt('p-manage', this)">‚öôÔ∏è</div>
        <div class="nav-item" onclick="nt('p-prof', this)">üë§</div>
    </nav>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, set, onValue, remove, update, get } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        const firebaseConfig = { databaseURL: "https://flutter-ai-playground-e9460-default-rtdb.asia-southeast1.firebasedatabase.app" };
        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        
        let currentImgBase64 = "";

        // NOTIFIKASI SYSTEM
        const triggerNotif = (msg) => {
            const t = document.getElementById('toast');
            t.innerText = msg;
            t.style.display = 'block';
            setTimeout(() => { t.style.display = 'none'; }, 2500);
        };

        // IMAGE PREVIEW FIX
        window.previewFile = (input) => {
            const file = input.files[0];
            const reader = new FileReader();
            reader.onloadend = () => {
                currentImgBase64 = reader.result;
                const pi = document.getElementById('pi');
                pi.src = currentImgBase64;
                pi.style.display = "block";
                document.getElementById('ut').style.display = "none";
            }
            if (file) reader.readAsDataURL(file);
        };

        // SAVE PRODUCT FIX
        window.saveProduct = async () => {
            const name = document.getElementById('pn').value;
            const price = document.getElementById('pp').value;
            const btn = document.getElementById('btn-save');

            if(!name || !price || !currentImgBase64) {
                alert("Isi Nama, Harga, dan Foto!");
                return;
            }

            btn.disabled = true;
            btn.innerText = "SEDANG MENYIMPAN...";

            const newId = "prod_" + Date.now();
            try {
                await set(ref(db, 'vortex_items/' + newId), {
                    name: name,
                    price: price,
                    img: currentImgBase64
                });
                
                triggerNotif("PRODUK BERHASIL DIBUAT!");
                
                // RESET FORM
                document.getElementById('pn').value = "";
                document.getElementById('pp').value = "";
                document.getElementById('pi').style.display = "none";
                document.getElementById('ut').style.display = "block";
                currentImgBase64 = "";
                
                setTimeout(() => {
                    nt('p-home', document.querySelector('.nav-item'));
                    btn.disabled = false;
                    btn.innerText = "SIMPAN PRODUK";
                }, 1000);

            } catch (e) {
                alert("Gagal simpan: " + e.message);
                btn.disabled = false;
            }
        };

        // AUTH & NAVIGATION
        window.auth = async () => {
            const u = document.getElementById('au').value.trim();
            const p = document.getElementById('ap').value;
            const s = await get(ref(db, `users/${u}`));
            if(s.exists() && s.val().pass === p) {
                localStorage.setItem('vx_u', u);
                location.reload();
            } else alert("Salah Password!");
        };

        window.nt = (id, el) => {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            if(el) el.classList.add('active');
        };

        // RENDER DATA
        window.onload = () => {
            const u = localStorage.getItem('vx_u');
            if(!u) return;

            document.getElementById('auth-screen').style.display = 'none';
            document.getElementById('h-main').style.display = 'flex';
            document.getElementById('c-main').style.display = 'block';
            document.getElementById('nb').style.display = 'flex';

            if(u === "Ranzz_Own") {
                document.querySelectorAll('.owner-only').forEach(e => e.style.setProperty('display','flex','important'));
            }

            onValue(ref(db, 'vortex_items'), (snap) => {
                const lp = document.getElementById('list-prod');
                const lm = document.getElementById('list-manage');
                lp.innerHTML = ''; lm.innerHTML = '';
                
                snap.forEach(child => {
                    const d = child.val();
                    const k = child.key;
                    
                    // Home Card
                    lp.innerHTML += `
                        <div class="card" style="display:flex; align-items:center; gap:15px;">
                            <img src="${d.img}" style="width:70px; height:70px; border-radius:12px; object-fit:cover; border:1px solid #ddd;">
                            <div>
                                <b style="font-size:15px;">${d.name}</b><br>
                                <span style="color:var(--accent); font-weight:800;">IDR ${d.price}</span>
                            </div>
                        </div>`;
                    
                    // Manage Card
                    if(u === "Ranzz_Own") {
                        lm.innerHTML += `
                            <div class="card" style="display:flex; justify-content:space-between; align-items:center;">
                                <span>${d.name}</span>
                                <button class="btn btn-del" onclick="deleteItem('${k}')">HAPUS</button>
                            </div>`;
                    }
                });
            });
        };

        window.deleteItem = (id) => {
            if(confirm("Hapus produk ini?")) {
                remove(ref(db, 'vortex_items/' + id));
                triggerNotif("PRODUK DIHAPUS!");
            }
        };
    </script>
</body>
</html>
